<!DOCTYPE html>
<html>
    <head>
        <title>Page Title</title>
    </head>
    <body>
        <h1>This is a Heading</h1>
        <p>This is a paragraph.</p>
        <button id="myButton">Click me!</button>
        <input type="file" id="fileInput">
        <pre id="output"></pre>
    </body>
</html>

<script>
    const button = document.getElementById('myButton');
    button.addEventListener('click', () => {
        const notePattern1 = ["A", "B", "C", "D", "E", "F", "G", "A", "B", "C"];
        localStorage.setItem('notePattern1', JSON.stringify(notePattern1));
        window.location.href = "./sound.html";
    });


    document.getElementById('fileInput').addEventListener('change', handleFileSelect, false);

    function handleFileSelect(event) {
        const file = event.target.files[0];
        const reader = new FileReader();

        reader.onload = function(e) {
            const contents = e.target.result;
            const lines = contents.split('\n');
            let processedContents = '';

            for (const line of lines) {
                if (!line.startsWith('\\')) {
                    processedContents += line + '\n';
                }
            }

            const rows = processedContents.split('\n');
            processedContents = {
                3.4: [],
                4.6: [],
                12: [],
                22: []
            };

            let limit = {
                3.4: { min: null, max: null },
                4.6: { min: null, max: null },
                12: { min: null, max: null },
                22: { min: null, max: null }
            };

            const headerRow = rows[0].trim().split('|');
            for(const i in headerRow) {
                headerRow[i] = headerRow[i].trim();
            }

            const raIndex = headerRow.indexOf('ra') - 1;
            const decIndex = headerRow.indexOf('dec') - 1;
            const ph_qualIndex = headerRow.indexOf('ph_qual') - 1;
            const cc_flagsIndex = headerRow.indexOf('cc_flags') - 1;

            const w1satIndex = headerRow.indexOf('w1sat') - 1;
            const w1snrIndex = headerRow.indexOf('w1snr') - 1;
            const w1mproIndex = headerRow.indexOf('w1mpro') - 1;

            const w2satIndex = headerRow.indexOf('w2sat') - 1;
            const w2snrIndex = headerRow.indexOf('w2snr') - 1;
            const w2mproIndex = headerRow.indexOf('w2mpro') - 1;

            const w3satIndex = headerRow.indexOf('w3sat') - 1;
            const w3snrIndex = headerRow.indexOf('w3snr') - 1;
            const w3mproIndex = headerRow.indexOf('w3mpro') - 1;

            const w4satIndex = headerRow.indexOf('w4sat') - 1;
            const w4snrIndex = headerRow.indexOf('w4snr') - 1;
            const w4mproIndex = headerRow.indexOf('w4mpro') - 1;

            for (let i = 4; i < rows.length; i++)
            {
                const columns = rows[i].trim().split(/\s+/);
                const ra = parseFloat(columns[raIndex]);
                const dec = parseFloat(columns[decIndex]);
                const ph_qual = columns[ph_qualIndex];
                const cc_flags = columns[cc_flagsIndex];
                
                const w1mpro = parseFloat(columns[w1mproIndex]);
                const w1sat = parseFloat(columns[w1satIndex]);
                const w1snr = parseFloat(columns[w1snrIndex]);

                const w2mpro = parseFloat(columns[w2mproIndex]);
                const w2sat = parseFloat(columns[w2satIndex]);
                const w2snr = parseFloat(columns[w2snrIndex]);

                const w3mpro = parseFloat(columns[w3mproIndex]);
                const w3sat = parseFloat(columns[w3satIndex]);
                const w3snr = parseFloat(columns[w3snrIndex]);

                const w4mpro = parseFloat(columns[w4mproIndex]);
                const w4sat = parseFloat(columns[w4satIndex]);
                const w4snr = parseFloat(columns[w4snrIndex]);

                if (ph_qual != null && (ph_qual[0] == 'A' || ph_qual[0] == 'B')
                    && cc_flags == "0000" && w1sat < 0.1 && w1snr > 3)
                {
                    processedContents[3.4].push([ra, dec, w1mpro]);
                    if (limit[3.4].min == null || limit[3.4].min > w1mpro) {
                        limit[3.4].min = w1mpro;
                    }
                    if (limit[3.4].max == null || limit[3.4].max < w1mpro) {
                        limit[3.4].max = w1mpro;
                    }
                }

                if (ph_qual != null && (ph_qual[1] == 'A' || ph_qual[1] == 'B')
                    && cc_flags == "0000" && w2sat < 0.1 && w2snr > 3)
                {
                    processedContents[4.6].push([ra, dec, w2mpro]);
                    if (limit[4.6].min == null || limit[4.6].min > w2mpro) {
                        limit[4.6].min = w2mpro;
                    }
                    if (limit[4.6].max == null || limit[4.6].max < w2mpro) {
                        limit[4.6].max = w2mpro;
                    }
                }

                if (ph_qual != null && (ph_qual[2] == 'A' || ph_qual[2] == 'B')
                    && cc_flags == "0000" && w3sat < 0.1 && w3snr > 3)
                {
                    processedContents[12].push([ra, dec, w3mpro]);
                    if (limit[12].min == null || limit[12].min > w3mpro) {
                        limit[12].min = w3mpro;
                    }
                    if (limit[12].max == null || limit[12].max < w3mpro) {
                        limit[12].max = w3mpro;
                    }
                }

                if (ph_qual != null && (ph_qual[3] == 'A' || ph_qual[3] == 'B')
                    && cc_flags == "0000" && w4sat < 0.1 && w4snr > 3)
                {
                    processedContents[22].push([ra, dec, w4mpro]);
                    if (limit[22].min == null || limit[22].min > w4mpro) {
                        limit[22].min = w4mpro;
                    }
                    if (limit[22].max == null || limit[22].max < w4mpro) {
                        limit[22].max = w4mpro;
                    }
                }
            }

            printData(processedContents, limit);
        };

        reader.readAsText(file);
    }

    function printData(processedContents, limit)
    {
        document.getElementById('output').textContent = JSON.stringify(processedContents);

    }


</script>